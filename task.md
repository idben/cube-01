# 立方塊算數練習 - 製作步驟檢查清單

## 專案概述
製作一個基於 Three.js 的 3D 立方塊互動應用程式,用於算數練習。

### 核心功能
- **隨機生成立方塊堆疊結構**: 6 種不同的 3D 結構 (6-14 個立方塊)
- **互動式 3D 旋轉**: 滑鼠拖曳和自動旋轉功能
- **答題系統**: 輸入答案、驗證、計分
- **即時反饋**: 答對/答錯對話框提示
- **進度追蹤**: 題號和分數顯示

## 技術規格

### 基礎技術要求
- **HTML/CSS/JS 分離**: 三個檔案獨立管理
- **原生 JavaScript**: 不使用 Vue、React 等框架
- **3D 渲染引擎**: 使用 Three.js
- **DOM 操作**: 僅使用 `querySelector` 和 `querySelectorAll`
- **對話框**: 使用 HTML5 `<dialog>` 元素替代 `alert` 和 `confirm`
- **樣式系統**: 參考 Bootstrap 的按鈕和顏色設計(手動實現,不引入完整框架)

---

## 製作步驟檢查清單

### 第一階段: 專案初始化

#### 1.1 專案結構
- [x] 建立 index.html
- [x] 建立 style.css
- [x] 建立 script.js
- [x] 建立 README.md

#### 1.2 HTML 基礎架構
- [x] 建立 HTML5 文檔結構(DOCTYPE、head、body)
- [x] 引入 Three.js CDN (使用 jsdelivr CDN + ES 模組 + importmap)
- [x] 建立 canvas-container 容器
- [x] 建立 controls 控制區域
- [x] 建立 dialog 對話框元素
- [x] 正確連結外部 CSS 和 JS 檔案

#### 1.3 CSS 基礎設定
- [x] Reset 基本樣式
- [x] 設定 body 和 html 寬高 100%
- [x] Canvas 容器樣式(居中顯示)
- [x] Bootstrap 風格按鈕樣式
  - [x] 主要按鈕(藍色 #007bff)
  - [x] 成功按鈕(綠色 #28a745)
  - [x] 危險按鈕(紅色 #dc3545)
  - [x] Hover 效果和過渡動畫
- [x] Dialog 樣式(居中、背景遮罩、圓角陰影)

---

### 第二階段: Three.js 場景建立

#### 2.1 基礎場景設定
- [x] 使用 ES 模組導入 Three.js (import * as THREE from 'three')
- [x] 建立場景(Scene)
- [x] 建立相機(PerspectiveCamera)
- [x] 建立渲染器(WebGLRenderer)
- [x] 將渲染器加入 DOM

#### 2.2 建立立方體
- [x] 建立幾何體(BoxGeometry)
- [x] 建立材質(MeshPhongMaterial)
- [x] 建立網格(Mesh)
- [x] 將立方體加入場景

#### 2.3 添加光源
- [x] 添加環境光(AmbientLight)
- [x] 添加方向光(DirectionalLight)

---

### 第三階段: 實現垂直軸旋轉功能

#### 3.1 座標軸設定
- [x] 使用 Three.js 標準座標系 (Y 軸垂直向上)
- [x] 建立座標軸輔助線 (X軸=紅色, Y軸=綠色, Z軸=藍色)
- [x] 調整相機位置以觀看垂直旋轉效果

#### 3.2 旋轉控制
- [x] 設定旋轉控制變數 (targetRotationY, currentRotationY)
- [x] 建立動畫循環函數
- [x] 實現 Y 軸旋轉邏輯(Y軸垂直向上,固定 X 和 Z 軸)

#### 3.3 用戶交互控制
- [x] 實現滑鼠拖曳旋轉 (水平拖曳控制 Y 軸旋轉)
  - [x] mousedown 事件監聽
  - [x] mousemove 事件監聽 (deltaX → rotation.y)
  - [x] mouseup 事件監聽
- [x] 實現觸控支援 (水平滑動控制 Y 軸旋轉)

#### 3.4 按鈕控制
- [x] 自動旋轉按鈕功能 (繞 Y 軸旋轉)
- [x] 重置按鈕功能 (重置 Y 軸角度)

---

### 第四階段: 響應式設計

#### 4.1 視窗調整
- [x] 實現 resize 事件監聽
- [x] 更新相機長寬比
- [x] 更新渲染器大小

---

### 第五階段: Bootstrap 風格按鈕

#### 5.1 按鈕樣式
- [x] .btn 基礎樣式
- [x] .btn-primary 樣式
- [x] .btn-success 樣式
- [x] .btn-danger 樣式
- [x] Hover 效果

---

### 第六階段: Dialog 對話框

#### 6.1 Dialog 實現
- [x] HTML dialog 結構
- [x] Dialog 樣式設定
  - [x] 畫面中央定位 (position: fixed, top: 50%, left: 50%, transform: translate(-50%, -50%))
  - [x] 半透明黑色背景遮罩 (backdrop: rgba(0, 0, 0, 0.6))
  - [x] 背景模糊效果 (backdrop-filter: blur(5px))
  - [x] 圓角和陰影效果
- [x] showDialog 函數實現
- [x] 確定/取消按鈕功能
- [x] 答對答錯時隱藏取消按鈕 (showCancel 參數預設為 false)

---

### 第七階段: 立方塊堆疊結構系統

#### 7.1 資料結構定義
- [x] 定義 cubeStructures 陣列 (包含 6 種不同結構)
- [x] 使用 3D 座標陣列表示每個結構 [[x, y, z], ...]
- [x] 結構 1: 階梯狀 (14 個立方塊)
- [x] 結構 2: L 型 (11 個立方塊)
- [x] 結構 3: 金字塔 (9 個立方塊)
- [x] 結構 4: T 型 (10 個立方塊)
- [x] 結構 5: 簡單階梯 (6 個立方塊)
- [x] 結構 6: 不規則 (12 個立方塊)

#### 7.2 立方塊群組建立
- [x] createCubeStructure 函數實現
- [x] 使用 THREE.Group 容納多個小立方塊
- [x] 設定單個立方塊大小為 0.95 (間隙效果)
- [x] 共用 BoxGeometry 以節省記憶體
- [x] 為每個座標建立獨立的 Mesh
- [x] 計算並置中整個群組 (使用 Box3)

#### 7.3 隨機題目生成
- [x] generateNewQuestion 函數實現
- [x] 隨機選擇一個結構 (Math.random)
- [x] 移除舊的立方塊群組並清理記憶體
- [x] 建立新的立方塊群組並加入場景
- [x] 設定正確答案 (結構長度)
- [x] 重置旋轉角度
- [x] 更新題號和顯示

---

### 第八階段: 答題系統

#### 8.1 遊戲狀態管理
- [x] 定義遊戲狀態變數 (currentAnswer, score, totalQuestions)
- [x] updateQuestionDisplay 函數 (更新題號和分數顯示)

#### 8.2 HTML 答題介面
- [x] 題目和分數顯示面板 (question-panel)
  - [x] 題號顯示 (question-number)
  - [x] 分數顯示 (score-display)
- [x] 答題輸入區域 (answer-panel)
  - [x] 問題標籤 (label)
  - [x] 數字輸入框 (input type="number")
  - [x] 提交答案按鈕 (submit-btn)
- [x] 更新控制按鈕區
  - [x] 開始/停止旋轉按鈕
  - [x] 重置角度按鈕
  - [x] 下一題按鈕 (next-btn)

#### 8.3 答案驗證功能
- [x] checkAnswer 函數實現
- [x] 驗證使用者輸入 (數字檢查)
- [x] 答對處理
  - [x] 分數加 10
  - [x] 顯示答對對話框
  - [x] 自動進入下一題
- [x] 答錯處理
  - [x] 顯示正確答案
  - [x] 允許重試
- [x] Enter 鍵提交支援

#### 8.4 CSS 樣式實現
- [x] 題目和分數面板樣式
  - [x] 固定在頂部中央
  - [x] 半透明白色背景
  - [x] 圓角和陰影效果
  - [x] 藍色題號、綠色分數
- [x] 答題區域樣式
  - [x] 固定在題目下方
  - [x] 輸入框樣式和 focus 效果
  - [x] 按鈕群組排列
- [x] 響應式設計擴展
  - [x] 平板尺寸適配 (768px)
  - [x] 手機尺寸適配 (480px)
  - [x] 垂直排列和寬度調整

---

### 第九階段: 固定配色系統 (無光照)

#### 9.1 材質更新
- [x] 改用 MeshBasicMaterial (不受光照影響)
- [x] 固定配色方案實現
  - [x] 上面 (+Y): 白色 (0xffffff)
  - [x] 右面 (+X): 淺灰色 (0xcccccc)
  - [x] 左面 (-X): 深灰色 (0x666666)
  - [x] 其他面: 中灰色 (0x999999)

#### 9.2 光源停用
- [x] 停用所有光源 (addLights 函數註解)
- [x] 確保顏色完全固定不受環境影響

---

### 第十階段: 隨機生成系統與重力模擬

#### 10.1 隨機結構生成
- [x] 移除固定的 8 種結構定義
- [x] 實現 generateRandomStructure 函數
  - [x] 隨機立方塊數量 (6-15 個)
  - [x] 隨機 3D 位置生成 (3x3x10 空間)
  - [x] 避免位置重複

#### 10.2 重力模擬系統
- [x] 實現 applyGravity 函數
- [x] 偵測懸空立方塊
- [x] 將立方塊往下掉落到最近的支撐
- [x] 同一 (x, z) 位置的立方塊自動堆疊

#### 10.3 題目生成更新
- [x] 更新 generateNewQuestion 使用隨機生成
- [x] 每題都是獨特的隨機結構
- [x] 保持隨機旋轉角度功能

---

### 第十一階段: 介面優化

#### 11.1 移除座標軸顯示
- [x] 停用 createAxisHelpers 函數
- [x] 移除座標軸輔助線和標籤
- [x] 簡化啟動訊息

#### 11.2 旋轉角度 Console 顯示
- [x] 滑鼠拖曳時顯示即時旋轉角度
- [x] 滑鼠放開時顯示最終角度
- [x] 觸控拖曳時顯示即時旋轉角度
- [x] 觸控結束時顯示最終角度
- [x] 角度以度數顯示 (0-360°)

---

### 第十二階段: 正交相機 (無透視)

#### 12.1 相機系統更新
- [x] 改用 OrthographicCamera 取代 PerspectiveCamera
- [x] 計算視錐體參數 (left, right, top, bottom)
- [x] 設定 viewSize 為 8 (可調整縮放程度)
- [x] 視錐體根據長寬比動態計算

#### 12.2 響應式調整
- [x] 更新 resize 事件處理器
- [x] 動態重新計算正交相機視錐體
- [x] 保持與 viewSize 一致性

---

## 測試項目

### 功能測試
- [x] 立方塊堆疊結構正確顯示在畫面中央
- [x] 滑鼠水平拖曳可以繞 Y 軸旋轉 (像陀螺)
- [x] Console 顯示旋轉角度
- [x] 自動旋轉按鈕運作正常 (繞 Y 軸)
- [x] 重置按鈕運作正常 (重置到 Y 軸角度 0)
- [x] Dialog 在畫面中央正確顯示
- [x] Dialog 背景有半透明黑色遮罩和模糊效果
- [x] Dialog 確定/取消按鈕運作正常
- [x] 隨機生成不同的立方塊堆疊結構
- [x] 題目和分數正確顯示
- [x] 答案輸入框正常運作
- [x] 提交答案功能正確 (答對/答錯邏輯)
- [x] 答對自動進入下一題
- [x] 下一題按鈕生成新結構
- [x] Enter 鍵可提交答案
- [x] 記憶體正確清理 (舊結構移除)
- [x] 固定配色正確顯示 (上白/右淺灰/左深灰)
- [x] 立方塊顏色不受光照影響
- [x] 隨機結構生成正常運作
- [x] 重力模擬正確 (無懸空立方塊)
- [x] 每題結構都不同

### 瀏覽器兼容性測試
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

### 響應式測試
- [ ] 桌面瀏覽器(1920x1080)
- [ ] 平板(768x1024)
- [ ] 手機(375x667)

---

## 優化建議

### 性能優化
- [x] 使用 requestAnimationFrame
- [x] 設定渲染器 pixelRatio
- [ ] 考慮 FPS 限制

### 用戶體驗優化
- [ ] 添加載入動畫
- [ ] 添加操作提示
- [ ] 添加鍵盤快捷鍵
- [x] 添加觸控支持

### 程式碼優化
- [x] 使用 ES6+ 語法
- [ ] 適當的錯誤處理
- [x] 添加程式碼註釋
- [x] 模組化設計

---

## 後續擴展功能建議

### 已完成功能
1. [x] ~~多個立方體: 場景中有多個可旋轉的立方體~~ → 已實現立方塊堆疊結構
2. [x] ~~計分系統: 記錄答題正確率~~ → 已實現分數和題號追蹤

### 建議新增功能
1. [ ] 更多立方塊堆疊結構: 增加到 20+ 種不同的結構模式
2. [ ] 顏色變化: 根據答題正確與否改變立方塊顏色
   - [ ] 答對時變綠色
   - [ ] 答錯時變紅色
   - [ ] 漸變動畫效果
3. [ ] 音效系統
   - [ ] 旋轉音效
   - [ ] 答對音效
   - [ ] 答錯音效
   - [ ] 按鈕點擊音效
4. [ ] 難度選擇系統
   - [ ] 簡單 (6-8 個立方塊)
   - [ ] 中等 (9-12 個立方塊)
   - [ ] 困難 (13-20 個立方塊)
   - [ ] 難度選擇介面
5. [ ] 時間限制功能
   - [ ] 倒數計時器
   - [ ] 時間獎勵分數
   - [ ] 時間到自動跳下一題
6. [ ] 統計系統
   - [ ] 正確率顯示
   - [ ] 平均答題時間
   - [ ] 連續答對紀錄
7. [ ] 成績儲存
   - [ ] 使用 localStorage 儲存成績
   - [ ] 排行榜顯示 (前 10 名)
   - [ ] 個人最佳紀錄
8. [ ] 提示系統
   - [ ] 提示按鈕 (扣分)
   - [ ] 顯示一個立方塊位置
   - [ ] 顯示部分結構
9. [ ] 立方塊標記功能
   - [ ] 點擊立方塊標記已數過
   - [ ] 不同顏色標示
   - [ ] 重置標記功能
10. [ ] 成就系統
    - [ ] 連續答對 5 題
    - [ ] 達成 100 分
    - [ ] 完成 20 題

---

## 注意事項

1. **Three.js 版本**:
   - 使用 Three.js v0.170.0 (透過 jsdelivr CDN)
   - 使用 ES 模組格式 (不再使用舊的 three.min.js)
   - 透過 importmap 管理依賴
   - script 標籤需加上 type="module"

2. **相機系統**:
   - 使用 OrthographicCamera (正交投影,無透視效果)
   - viewSize 設定為 8 (控制視野大小)
   - 視錐體根據視窗長寬比動態計算
   - 相機位置: (5, 5, 4) 從斜上方觀看

3. **座標系統**:
   - 使用 Three.js 標準右手座標系
   - X 軸 (紅色): 水平向右
   - Y 軸 (綠色): **垂直向上** (旋轉軸)
   - Z 軸 (藍色): 水平向前
   - 立方體繞 Y 軸旋轉,效果像陀螺旋轉

4. **立方塊堆疊系統**:
   - 隨機生成結構 (非固定題型)
   - 立方塊數量: 6-15 個 (隨機)
   - 生成空間: 3x3x10 (X, Z, Y)
   - 重力模擬: 懸空立方塊自動掉落堆疊
   - 使用 THREE.Group 管理多個立方塊
   - 立方塊大小為 1.0 (無間隙)
   - 群組自動置中 (使用 Box3 計算中心點)
   - 添加黑色邊框 (EdgesGeometry + LineSegments)

5. **記憶體管理**:
   - 切換題目時清理舊的 geometry 和 material
   - 使用 `traverse` 遍歷群組清理物件
   - 使用 `dispose()` 釋放 GPU 記憶體
   - 共用 geometry 以節省記憶體

6. **材質與配色系統**:
   - 使用 MeshBasicMaterial (不受光照影響)
   - 固定配色方案:
     - 上面 (+Y): 白色 (0xffffff)
     - 右面 (+X): 淺灰色 (0xcccccc)
     - 左面 (-X): 深灰色 (0x666666)
     - 其他面: 中灰色 (0x999999)
   - 光源已停用 (材質不需要光照)

7. **遊戲邏輯**:
   - 答對加 10 分
   - 答錯不扣分,可重試
   - 答對自動進入下一題
   - 支援 Enter 鍵提交答案
   - 出題時隨機 Y 軸旋轉角度 (8 個固定角度)

8. **querySelector 語法**: 確保所有 DOM 操作都使用 querySelector 系列方法

9. **Dialog polyfill**: 舊版瀏覽器可能需要 dialog polyfill

10. **跨域問題**: 使用本地伺服器執行 (推薦 python -m http.server 或 npx http-server)

11. **性能監控**: 使用 Chrome DevTools 監控性能

---

## 開發時程建議

### 第一版 (基礎立方體旋轉) - 已完成
- **第一天**: 完成專案架構、HTML/CSS 基礎
- **第二天**: 完成 Three.js 場景建立、立方體顯示
- **第三天**: 完成 Y 軸旋轉功能、用戶交互
- **第四天**: 完成按鈕、Dialog、響應式設計
- **第五天**: 測試、優化、文檔撰寫

### 第二版 (立方塊堆疊與答題系統) - 已完成
- **擴展第一天**: 設計立方塊堆疊資料結構 (6 種結構)
- **擴展第二天**: 實現多立方塊群組系統、隨機生成功能
- **擴展第三天**: 建立答題介面 (HTML/CSS)
- **擴展第四天**: 實現答案驗證和計分系統
- **擴展第五天**: 整合測試、優化記憶體管理、更新文檔

---

## 參考資源

- [Three.js 官方文檔](https://threejs.org/docs/)
- [Three.js 範例](https://threejs.org/examples/)
- [MDN - Dialog element](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog)
- [MDN - querySelector](https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector)
- [Bootstrap 顏色系統](https://getbootstrap.com/docs/5.0/customize/color/)
